@page "/Campaigns"
@using MudBlazor
@using Domain.Entities
@using Application.Services.Campaigns
@inject IDialogService DialogService
@inject ICampaignService CampaignService

<PageTitle>Campaign</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-8">
    <MudPaper Elevation="0" Class="mb-6">
        <MudStack Row="true" Spacing="3" AlignItems="AlignItems.Center" Class="p-6">
            <MudText Typo="Typo.h4" GutterBottom="false">Campaign Page</MudText>
            <MudSpacer />
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(()=>OpenDialog())">
                +Add Customer
            </MudButton>
        </MudStack>
    </MudPaper>

    <MudPaper Elevation="1">
        <MudDataGrid T="Campaign"
                     Items="@campaigns"
                     Hover="true"
                     Bordered="true"
                     Striped="true"
                     Dense="false"
                     Class="mud-elevation-1">

            <Columns>

                <!-- ID -->
                <PropertyColumn Property="x => x.Id" Title="Id" Sortable="true" />

                <!-- NAME -->
                <PropertyColumn Property="x => x.Name" Title="Name" Sortable="true" />

                <!-- DESCRIPTION -->
                <TemplateColumn Title="Description" Sortable="true">
                    <CellTemplate>
                        <MudTooltip Text="@context.Item.Description" Color="Color.Primary">
                            <span>
                                @(context.Item.Description?.Length > 30
                                  ? context.Item.Description.Substring(0, 30) + "..."
                                  : context.Item.Description)
                            </span>
                        </MudTooltip>
                    </CellTemplate>
                </TemplateColumn>

                <!-- START DATE -->
                <TemplateColumn Title="Start Date" Sortable="true">
                    <CellTemplate>
                        <MudChip T="string" Size="Size.Small" Color="Color.Info">
                            @context.Item.StartDate.ToShortDateString()
                        </MudChip>
                    </CellTemplate>
                </TemplateColumn>

                <!-- END DATE -->
                <TemplateColumn Title="End Date" Sortable="true">
                    <CellTemplate>
                        <MudChip T="string" Size="Size.Small" Color="Color.Info">
                            @context.Item.EndDate.ToShortDateString()
                        </MudChip>
                    </CellTemplate>
                </TemplateColumn>

                <!-- BUDGET -->
                <TemplateColumn Title="Budget" Sortable="true">
                    <CellTemplate>
                        <MudText Typo="Typo.body2" Color="Color.Success">
                            $@context.Item.Budget
                        </MudText>
                    </CellTemplate>
                </TemplateColumn>

                <!-- STATUS -->
                <TemplateColumn Title="Status" Sortable="true">
                    <CellTemplate>
                        <MudChip T="string"
                                 Color="@GetStatusColor(context.Item.Status)"
                                 Text="@context.Item.Status"
                                 Icon="@Icons.Material.Filled.Done" />
                    </CellTemplate>
                </TemplateColumn>

                <!-- TYPE -->
                <TemplateColumn Title="Type" Sortable="true">
                    <CellTemplate>
                        <MudChip T="string" Size="Size.Small" Color="Color.Secondary">
                            @context.Item.Type
                        </MudChip>
                    </CellTemplate>
                </TemplateColumn>

                <!-- ACTIONS -->
                <TemplateColumn Title="Actions">
                    <CellTemplate>
                        <MudStack Row="true" Spacing="2" Justify="Justify.Center">
                            <MudButton Href="@string.Format("/Campaigns/{0}", context.Item.Id)"
                                       Variant="Variant.Filled"
                                       Color="Color.Primary"
                                       Size="Size.Small"
                                       StartIcon="@Icons.Material.Filled.MoreHoriz">
                                View
                            </MudButton>

                            <MudButton Href="@string.Format("/Campaigns/edit/{0}", context.Item.Id)"
                                       Variant="Variant.Filled"
                                       Color="Color.Warning"
                                       Size="Size.Small"
                                       StartIcon="@Icons.Material.Filled.Edit">
                                Edit
                            </MudButton>
                        </MudStack>
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
            <PagerContent>
        <MudTablePager PageSizeOptions="new int[]{5,10,20}" />
    </PagerContent>
    </MudDataGrid>
    </MudPaper>
</MudContainer>


    

@code {

    List<Campaign> campaigns = new List<Campaign>();
   protected override void OnInitialized()
    {
        campaigns = CampaignService.GetAllCampaigns();
    }  
    protected IDialogReference dialogReference;
    private Color GetStatusColor(string status)
    {
        return status switch
        {
            "Active" => Color.Success,
            "Completed" => Color.Info,
            "Pending" => Color.Warning,
            "Cancelled" => Color.Error,
            _ => Color.Default
        };
    }
    private async Task OpenDialog(List<Campaign>? campaigns = null)
   {
    var dialog = await DialogService.ShowAsync<CreateCampaignDialog>("Add Campaign");
    var result = await dialog.Result;

    if (result != null && !result.Canceled)
    {
        campaigns = CampaignService.GetAllCampaigns();
    }
  }

}
    

