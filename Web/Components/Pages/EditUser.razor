@page "/Users/Edit/{Id:int}"

@rendermode InteractiveServer

@using Application.DTO
@using Application.Services.Users
@using System.ComponentModel.DataAnnotations
@using System.Configuration
@inject IUserService UserService
@inject NavigationManager NavigationManager
<PageTitle>Edit User</PageTitle>

<h3>Edit User</h3>
<a href="/Users" class="btn btn-secondary">Back to List</a>
    <h3>Edit User</h3>
    @if (loaded)
    {
        <div class="container mt-4">
        <div class="row justify-content-center">

        <EditForm Model="@Model" OnValidSubmit="OnValidSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary  class="alert alert-danger py-2 mb-3"/>

            <div class="row g-2 mb-2"> 
            <div class="col-md-6 ">
                    <label for="FirstName" class="form-label"> FirstName</label>
                    <InputText id="FirstName" class="form-control" @bind-Value="Model.FirstName" placeholder="Enter FirstName" />
                    <ValidationMessage For="@(() => Model.FirstName)" class="text-danger"/>
            </div>
            <div class="col-md-6 ">
                    <label for="LastName" class="form-label"> LastName</label>
                    <InputText id="LastName" class="form-control" @bind-Value="Model.LastName" placeholder="Enter LastName" />
                    <ValidationMessage For="@(() => Model.LastName)" class="text-danger"/>
            </div>
            <div class="col-md-6 ">
                    <label for="PhoneNumber" class="form-label"> PhoneNumber</label>
                    <InputText id="PhoneNumber" class="form-control" @bind-Value="Model.PhoneNumber" placeholder="Enter PhoneNumber" />
                    <ValidationMessage For="@(() => Model.PhoneNumber)" class="text-danger"/>
            </div>
                <div class="col-md-6 ">
                    <label for="Role" class="form-label"> Role</label>
                    <InputText id="Role" class="form-control" @bind-Value="Model.Role" placeholder="Enter Role" />
                    <ValidationMessage For="@(() => Model.Role)" class="text-danger"/>
            </div>
                <div class="col-md-6 ">
                    <label for="Password" class="form-label"> Password</label>
                    <InputText id="Password" class="form-control" @bind-Value="Model.Password" placeholder="Enter Password" />
                    <ValidationMessage For="@(() => Model.Password)" class="text-danger"/>
            </div>
                @* <div class="col-md-6 ">
                    <label for="CreatedBy" class="form-label"> CreatedBy</label>
                    <InputText id="CreatedBy" class="form-control" @bind-Value="Model.CreatedBy" placeholder="Enter CreatedBy" />
                    <ValidationMessage For="@(() => Model.CreatedBy)" class="text-danger"/>
            </div> *@
            <div>
            <button type="submit" class="btn btn-primary mt-3">Edit User</button>
            <a href="/Users" class="btn btn-link btn text-muted">Cancel</a>
            </div>
            </div>
            </EditForm>
    
    </div>  
    </div>
    }
    else
    {
        <p>Loading...</p>
        }
    

@code{
    [Parameter]
    public int Id { get; set; }

    public UserUpdateDTO Model{ get;set;}=new();
    private bool loaded;

    protected override void OnParametersSet()
    
    {
        var user=UserService.GetUserById(Id);
        if(user!=null)
        {
            Model=new UserUpdateDTO
            {
                FirstName=user.FirstName??"", 
                LastName=user.LastName??"",
                Role=user.Role??"",
                PhoneNumber=user.PhoneNumber??"",
                Password=user.Password??""

                    
            };
            loaded=true;
        }
       
    }
    private  void OnValidSubmit()
    {
        if (Model == null) return;
        UserService.UpdateUser(Id,Model);
        NavigationManager.NavigateTo("/Users");
    }
}