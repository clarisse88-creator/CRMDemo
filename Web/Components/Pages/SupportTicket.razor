
@page "/SupportTicket"
<h3>Support Ticket</h3>
@using MudBlazor
@using Domain.Entities
@using Application.Services.Tickets
@inject ITicketService TicketService
@inject IDialogService DialogService


<PageTitle>Ticket</PageTitle>


  @* <a href="/SupportTicket/create" class="btn btn-secondary ">AddTicket</a> *@
      @* <MudButton Href="/SupportTicket/create" Variant="Variant.Filled" Color="Color.Primary">Add Ticket</MudButton> *@
<MudSpacer />
<MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(()=>OpenDialog())">+AddTicket</MudButton>



<MudContainer MaxWidth="MaxWidth.Large" Class="py-8">
    <MudPaper Elevation="0" Class="mb-6">
        
        <MudStack Row="true" Spacing="3" AlignItems="AlignItems.Center" Class="p-6">
            <MudTable Items="_supportTicket" Hover="true" Bordered="true" Striped="true">
                
                <HeaderContent>
                    <MudTh>Id</MudTh>
                    <MudTh>CustomerId</MudTh>
                    <MudTh>Subject</MudTh>
                    <MudTh>Description</MudTh>
                    <MudTh>Status</MudTh>
                    <MudTh>CreatedAt</MudTh>
                    <MudTh>CreatedBy</MudTh>
                    <MudTh>Priority</MudTh>
                    <MudTh>Type</MudTh>
                    <MudTh>ClosedAt</MudTh>
                    <MudTh>Action</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Id">@context.Id</MudTd>
                    <MudTd >@context.CustomerId</MudTd>
                    <MudTd >@context.Subject</MudTd>
                    <MudTd >@context.Description</MudTd>
                    <MudTd >@context.Status</MudTd>
                    <MudTd >@context.CreatedAt</MudTd>
                    
                    <MudTd >@context.Priority</MudTd>
                    <MudTd >@context.Type</MudTd>
                    <MudTd >@context.closedAt</MudTd>
                    <MudTd Style="text-align:center"> </MudTd>
                        <MudStack Row="true" Spacing="2" Justify="Justify.Center">
                            <MudButton Href="@string.Format("/SupportTicket/Edit/{0}", context.Id)" 
                                       Variant="Variant.Filled" 
                                       Color="Color.Warning" 
                                       Size="Size.Small"
                                       StartIcon="@Icons.Material.Filled.Edit">
                                Edit
                            </MudButton>
                            <MudButton Href="@string.Format("/SupportTicket/{0}", context.Id)" 
                                       Variant="Variant.Filled" 
                                       Color="Color.Primary" 
                                       Size="Size.Small"
                                       StartIcon="@Icons.Material.Filled.MoreHoriz">
                                View
                            </MudButton>
                        </MudStack>               
                </RowTemplate>
                <PagerContent>
        <MudTablePager PageSizeOptions="new int[]{5,10,20}" />
    </PagerContent>
    </MudTable>
     </MudStack> 
</MudPaper>
</MudContainer>

@code {

    List<Ticket> _supportTicket = new List<Ticket>();
     protected override void OnInitialized()
        {
     _supportTicket = TicketService.GetAllTickets().ToList();
        }
     protected IDialogReference dialogReference;
    private Color GetStatusColor(string status)
    {
        return status switch
        {
            "Active" => Color.Success,
            "Completed" => Color.Info,
            "Pending" => Color.Warning,
            "Cancelled" => Color.Error,
            _ => Color.Default
        };
    }
    private async Task OpenDialog(List<Ticket>? _supportTicket = null)
   {
    var dialog = await DialogService.ShowAsync<TicketCreateDialog>("Add Ticket");
    var result = await dialog.Result;

    if (result != null && !result.Canceled)
    {
        _supportTicket = TicketService.GetAllTickets();
    }
  }
}
  

   
