@page "/Customers/Edit/{Id:int}"

@rendermode InteractiveServer

@using Application.DTO
@using Application.Services.Customers
@using System.ComponentModel.DataAnnotations
@using System.Configuration
@inject ICustomerService CustomerService
@inject NavigationManager NavigationManager
<PageTitle>Edit Customer</PageTitle>

<h3>Edit Customer</h3>
@* <a href="/Customers" class="btn btn-secondary">Back to List</a> *@
<MudButton Variant="Variant.Filled" Color="Color.Secondary" OnClick="BackToCustomers" StartIcon="@Icons.Material.Filled.ArrowBack"> Back</MudButton>

  
    @if (loaded)
    {
        <div class="container mt-4">
        <div class="row justify-content-center">

        <EditForm Model="@Model" OnValidSubmit="OnValidSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary  class="alert alert-danger py-2 mb-3"/>

            <div class="row g-2 mb-2"> 
            <div class="col-md-6 ">
                    <label for="FirstName" class="form-label"> Name</label>
                    <InputText id="FirstName" class="form-control" @bind-Value="Model.Name" placeholder="Enter Name" />
                    <ValidationMessage For="@(() => Model.Name)" class="text-danger"/>
            </div>
            <div class="col-md-6 ">
                    <label for="PhoneNumber" class="form-label"> Description</label>
                    <InputText id="PhoneNumber" class="form-control" @bind-Value="Model.PhoneNumber" placeholder="Enter Phone Number" />
                    <ValidationMessage For="@(() => Model.PhoneNumber)" class="text-danger"/>
            </div>
            <div class="col-md-6 ">
                    <label for="Address" class="form-label"> Address</label>
                    <InputText id="Address" class="form-control" @bind-Value="Model.Address" placeholder="Enter Address" />
                    <ValidationMessage For="@(() => Model.Address)" class="text-danger"/>
            </div>
                <div class="col-md-6 ">
                    <label for="City" class="form-label"> City</label>
                    <InputText id="City" class="form-control" @bind-Value="Model.City" placeholder="Enter City" />
                    <ValidationMessage For="@(() => Model.City)" class="text-danger"/>
            </div>
                <div class="col-md-6 ">
                    <label for="Type" class="form-label"> Type</label>
                    <InputText id="Type" class="form-control" @bind-Value="Model.Type" placeholder="Enter Type" />
                    <ValidationMessage For="@(() => Model.Type)" class="text-danger"/>
            </div>
                @* <div class="col-md-6 ">
                    <label for="CreatedBy" class="form-label"> CreatedBy</label>
                    <InputText id="CreatedBy" class="form-control" @bind-Value="Model.CreatedBy" placeholder="Enter CreatedBy" />
                    <ValidationMessage For="@(() => Model.CreatedBy)" class="text-danger"/>
            </div> *@
            <div>
            <button type="submit" class="btn btn-primary mt-3">Edit Customer</button>
            @* <a href="/Customers" class="btn btn-link btn text-muted">Cancel</a> *@
            @* <MudButton Type="Submit" Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Edit">Edit Customer</MudButton> *@
            <MudButton Href="@string.Format("/Customers")" Variant="Variant.Text" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.Cancel">Cancel</MudButton>
          

            </div>
            </div>
            </EditForm>
    
    </div>  
    </div>
    }
    else
    {
        <p>Loading...</p>
        }
    

@code{
    [Parameter]
    public int Id { get; set; }

    public CustomerUpdateDTO Model{ get;set;}=new();
    private bool loaded;

    protected override void OnParametersSet()
    
    {
        var customer=CustomerService.GetCustomerById(Id);
        if(customer!=null)
        {
            Model=new CustomerUpdateDTO
            {
                Name=customer.Name??"", 
                PhoneNumber=customer.PhoneNumber??"",
                Address=customer.Address??"",
                City=customer.City??"",
                Type=customer.Type?? "",
                @* CreatedBy=customer.CreatedBy, *@
                
                
            };
            loaded=true;
        }
       
    }
    private  void OnValidSubmit()
    {
        if (Model == null) return;
        CustomerService.UpdateCustomer(Id,Model);
        NavigationManager.NavigateTo("/Customers");
    }
     private void BackToCustomers()
    {
        NavigationManager.NavigateTo("/Customers");
    }
}
